openapi: 3.0.1
info:
  title: Chatvolt AI - WhatsApp/ZAPI API
  description: Endpoints for sending messages via WhatsApp Template and Z-API.
  termsOfService: http://chatvolt.ai/terms
  contact:
    email: support@chatvolt.ai
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 1.0.0
servers:
  - url: https://api.chatvolt.ai
tags:
  - name: whatsapp
paths:
  /zapi/{instanceId}/{contactPhone}/message:
    post:
      tags:
        - whatsapp
      summary: Sends a WhatsApp message through the Z-API integration.
      description: |-
        This endpoint allows sending a text message and/or attachments to a destination WhatsApp number, using a configured Z-API instance.
        The message is also registered in the conversation associated with the agent and contact.
      parameters:
        - in: path
          name: instanceId
          required: true
          schema:
            type: string
          description: "Z-API instance ID (externalId of the ServiceProvider of type 'zapi')."
        - in: path
          name: contactPhone
          required: true
          schema:
            type: string
          description: Recipient's WhatsApp number.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: Textual content of the message.
                attachments:
                  type: array
                  description: Optional list of attachments to be sent.
                  items:
                    type: object
                    properties:
                      url:
                        type: string
                        format: url
                        description: Public URL of the attachment.
                      name:
                        type: string
                        description: Attachment file name (optional).
                      mimeType:
                        type: string
                        description: MIME type of the attachment (e.g., 'image/jpeg', 'application/pdf'). Used to determine the media type in Z-API.
                    required:
                      - url
      responses:
        '200':
          description: Message sent and registered successfully. Returns the message object created in the system.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
        '400':
          description: Invalid request (e.g., missing `instanceId`, `contactPhone` in the path, or `message`/`attachments` missing in the body).
        '402':
          description: Premium functionality. The organization does not have an active subscription.
        '403':
          description: Unauthorized (e.g., invalid API key, or agent does not belong to the session's organization).
        '404':
          description: Resource not found (e.g., Z-API instance not found, agent not found, or invalid `contactPhone`).
        '500':
          description: Internal Server Error
  /whatsapp/{phoneNumberId}/template-message:
    post:
      tags:
        - whatsapp
      summary: Send a WhatsApp template message
      description: Send a pre-approved WhatsApp template message with optional dynamic variables to a contact
      parameters:
        - in: path
          name: phoneNumberId
          required: true
          schema:
            type: string
          description: ID of the WhatsApp Business phone number
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - to
                - text
                - agentId
                - templateName
                - templateLangCode
              properties:
                to:
                  type: string
                  description: Recipient's phone number with country code
                  example: '55987654321'
                text:
                  type: string
                  description: Message text to store in conversation history
                  example: 'Hello! Please check our latest offers.'
                agentId:
                  type: string
                  description: ID of the agent to associate with this message
                  example: 'abcd123465'
                templateName:
                  type: string
                  description: Name of the pre-approved WhatsApp template
                  example: 'special_offer'
                templateLangCode:
                  type: string
                  description: Language code for the template
                  example: 'en_US'
                defaultStatus:
                  type: string
                  enum: [RESOLVED, UNRESOLVED, HUMAN_REQUESTED]
                  description: The default status to set for the conversation.
                buttons:
                  type: array
                  description: Array of buttons for the template.
                  items:
                    type: object
                    required: [type, value, index]
                    properties:
                      type:
                        type: string
                        enum: [url, quick_reply, copy_code, flow, catalog]
                      value:
                        type: string
                        description: Value for the button variable (URL suffix or payload).
                      index:
                        oneOf:
                          - type: string
                          - type: integer
              additionalProperties:
                type: string
                pattern: '^var_[a-zA-Z_][a-zA-Z0-9_]*$'
                description: Dynamic template variables with 'var_' prefix (e.g., var_customer_name, var_order_id)
            examples:
              basic_template:
                summary: Basic template without variables
                value:
                  to: '55987654321'
                  text: 'Hello! Please check our latest offers.'
                  agentId: 'abcd123465'
                  templateName: 'special_offer'
                  templateLangCode: 'en_US'
              template_with_variables:
                summary: Template with dynamic variables
                value:
                  to: '55987654321'
                  text: 'Order confirmation for John Doe - Order #12345'
                  agentId: 'abcd123465'
                  templateName: 'order_confirmation'
                  templateLangCode: 'en_US'
                  var_customer_name: 'John Doe'
                  var_order_id: '12345'
                  var_delivery_date: 'January 25, 2024'
                  var_total_amount: '$299.99'
              template_with_button:
                summary: Template with dynamic button
                value:
                  to: '55987654321'
                  text: 'Click the button below to visit our site.'
                  agentId: 'abcd123465'
                  templateName: 'site_visit'
                  templateLangCode: 'en_US'
                  buttons:
                    - type: 'url'
                      value: 'promo2024'
                      index: '0'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Conversation ID
                  channelExternalId:
                    type: string
                    description: External ID for the channel
                  channel:
                    type: string
                    enum: [whatsapp]
                    description: Conversation channel
                  messages:
                    type: array
                    description: Messages in the conversation
                    items:
                      type: object
        '400':
          description: Bad Request - Missing required parameters
        '401':
          description: Unauthorized - Invalid token
        '402':
          description: Payment Required - Premium subscription required
        '404':
          description: Not Found - Phone number ID or agent not found
        '500':
          description: Internal Server Error
  /whatsapp/templates:
    get:
      tags:
        - whatsapp
      summary: List Meta templates
      description: Fetches all message templates from the associated WhatsApp Business Account (WABA).
      parameters:
        - in: query
          name: agentId
          required: true
          schema:
            type: string
          description: ID of the agent with WhatsApp configured.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        language:
                          type: string
                        status:
                          type: string
                        category:
                          type: string
                        id:
                          type: string
                        components:
                          type: array
                          items:
                            type: object
    post:
      tags:
        - whatsapp
      summary: Create Meta template
      description: Creates a new message template in the associated WhatsApp Business Account (WABA).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - name
                - category
                - language
                - components
              properties:
                agentId:
                  type: string
                  description: ID of the agent.
                name:
                  type: string
                  description: Name of the template.
                category:
                  type: string
                  enum: [MARKETING, UTILITY, AUTHENTICATION]
                  description: Category of the template.
                language:
                  type: string
                  description: Language code (e.g., "en_US").
                components:
                  type: array
                  items:
                    type: object
                  description: Template components (header, body, footer, buttons).
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
  /messages/interactive/send-buttons:
    post:
      tags:
        - whatsapp
      summary: Send buttons message
      description: Sends a message with up to 3 reply buttons. Supported on WhatsApp, Z-API, and ZapperAPI.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - conversationId
                - body_text
                - button_1_id
                - button_1_title
              properties:
                agentId:
                  type: string
                  description: The ID of the agent sending the message.
                conversationId:
                  type: string
                  description: The ID of the conversation.
                header_text:
                  type: string
                  description: Optional header text.
                body_text:
                  type: string
                  description: The main message body.
                footer_text:
                  type: string
                  description: Optional footer text.
                button_1_id:
                  type: string
                  description: ID for the first button.
                button_1_title:
                  type: string
                  description: Label for the first button.
                button_2_id:
                  type: string
                  description: ID for the second button.
                button_2_title:
                  type: string
                  description: Label for the second button.
                button_3_id:
                  type: string
                  description: ID for the third button.
                button_3_title:
                  type: string
                  description: Label for the third button.
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
  /messages/interactive/send-lists:
    post:
      tags:
        - whatsapp
      summary: Send list message
      description: Sends a message with a list of options (menu). Supported on WhatsApp, Z-API, and ZapperAPI.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - conversationId
                - body_text
                - button_text
              properties:
                agentId:
                  type: string
                  description: The ID of the agent.
                conversationId:
                  type: string
                  description: The ID of the conversation.
                header_text:
                  type: string
                  maxLength: 60
                  description: Optional header text.
                body_text:
                  type: string
                  maxLength: 4096
                  description: Main message body.
                footer_text:
                  type: string
                  maxLength: 60
                  description: Optional footer text.
                button_text:
                  type: string
                  maxLength: 20
                  description: Text for the button that opens the list.
                list_title:
                  type: string
                  description: Title for the list (mainly for Z-API).
              additionalProperties: true
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
  /messages/interactive/send-cta:
    post:
      tags:
        - whatsapp
      summary: Send CTA message
      description: Sends a message with a URL button. Supported on WhatsApp and Z-API.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - conversationId
                - body_text
                - button_display_text
                - button_url
              properties:
                agentId:
                  type: string
                  description: The ID of the agent.
                conversationId:
                  type: string
                  description: The ID of the conversation.
                header_text:
                  type: string
                  description: Optional header text.
                body_text:
                  type: string
                  description: Main message body.
                footer_text:
                  type: string
                  description: Optional footer text.
                button_display_text:
                  type: string
                  description: Label for the URL button.
                button_url:
                  type: string
                  format: url
                  description: The URL to open.
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
  /messages/interactive/send-location:
    post:
      tags:
        - whatsapp
      summary: Send location message
      description: Sends a specific location on a map. Supported on WhatsApp, Z-API, and ZapperAPI.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - conversationId
                - latitude
                - longitude
                - name
                - address
              properties:
                agentId:
                  type: string
                  description: The ID of the agent.
                conversationId:
                  type: string
                  description: The ID of the conversation.
                latitude:
                  type: string
                  description: Latitude of the location.
                longitude:
                  type: string
                  description: Longitude of the location.
                name:
                  type: string
                  description: Name of the place.
                address:
                  type: string
                  description: Address of the place.
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
  /messages/interactive/location-request:
    post:
      tags:
        - whatsapp
      summary: Send location request
      description: Sends a message asking the user to share their current location. Supported on WhatsApp only.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - conversationId
                - body_text
              properties:
                agentId:
                  type: string
                  description: The ID of the agent.
                conversationId:
                  type: string
                  description: The ID of the conversation.
                body_text:
                  type: string
                  description: Text explaining why the location is needed.
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
  /messages/interactive/send-contact:
    post:
      tags:
        - whatsapp
      summary: Send contact message
      description: Sends one or more contact cards. Supported on WhatsApp, Z-API, and ZapperAPI.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agentId
                - conversationId
                - name_formatted_name
              properties:
                agentId:
                  type: string
                  description: The ID of the agent.
                conversationId:
                  type: string
                  description: The ID of the conversation.
                name_formatted_name:
                  type: string
                  description: Full name as it should appear.
              additionalProperties: true
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
components:
  schemas:
    DatasourceChunk:
      type: object
      properties:
        text:
          type: string
          description: Content of the chunk.
        score:
          type: number
          description: Similarity score of the chunk with the query.
        source:
          type: string
          description: URL or identifier of the original source of the chunk.
        datasource_id:
          type: string
          description: ID of the datasource to which the chunk belongs.
        datasource_name:
          type: string
          description: Name of the datasource to which the chunk belongs.
        custom_id:
          type: string
          nullable: true
          description: Custom ID associated with the chunk (if any).
        tags:
          type: array
          items:
            type: string
          description: Tags associated with the chunk (if any).
    Message:
      type: object
      properties:
        id:
          type: string
        text:
          type: string
        html:
          type: string
          nullable: true
        from:
          type: string
          enum: [human, agent]
        conversationId:
          type: string
        sources:
          type: array
          items:
            $ref: '#/components/schemas/DatasourceChunk'
          nullable: true
        usage:
          type: object
          nullable: true
        externalId:
          type: string
          nullable: true
        userId:
          type: string
          nullable: true
        contactId:
          type: string
          nullable: true
        visitorId:
          type: string
          nullable: true
        agentId:
          type: string
          nullable: true
        metadata:
          type: object
          nullable: true
        inputId:
          type: string
          nullable: true
        eval:
          type: string
          nullable: true
          enum: [good, bad, null]
        read:
          type: boolean
        agentModel:
          type: string
          nullable: true
        usageCredits:
          type: number
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: []
